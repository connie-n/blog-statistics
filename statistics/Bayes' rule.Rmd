---
title: "제목"
author: "Connie"
date: "2021-02-19"
output: 
  html_document:
    self_contained: FALSE
    keep_md: FALSE
    theme: null
    highlight: null
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

오늘은 조건부 확률의 개념과 베이즈 정리에 대한 글을 써보려 합니다. 베이즈 정리는 사전 확률과 사후 확률의 관계를 조건부 확률의 개념을 통해 풀어낸 정리입니다. 기존에 베이즈 정리에 대한 설명과 수식만을 보고 이해가 잘 안갔던 점들을 오늘은 재미있는 영상과 예제를 소개하며, 다시 한 번 개념에 대해 이해해볼까 합니다.
 


### Conditional Probability (조건부 확률)

사전적 정의: 주어진 사건이 일어났다는 가정 하에 다른 한 사건이 일어날 확률을 뜻합니다. 원래의 확률 함수는 P라 할 때, 사건 B가 일어났다는 가정 하에 사건 A가 일어날 조건부 확률은 P(A|B)로 표기합니다. 

![image from D:\user\Documents\R projects\Tistory_슬통\Tistory](img.png){width=50%}



#### 예제: 주사위 굴리기

주사위를 굴릴 때 각 숫자가 나올 확률은 보통 1/6으로 가정합니다. 하지만 주사위를 굴리고 난 후, 얻는 숫자가 홀수라는 추가 정보가 있다고 생각해보죠. 이 새로운 정보는 우리가 1이 나올 확률을 계산할 때 영향을 미칩니다. 왜냐하면, 숫자가 홀수가 나왔다는 정보는 원래 주사위 숫자가 나올 수 있는 표본공간을  {1, 2, 3, 4, 5, 6}에서 {1, 3, 5}로 줄여버리기 때문입니다. 따라서 위의 식의 A와 B를 이번 예제에 적용하면 다음과 같습니다.


A: 주사위를 굴렸을때 1이 나오는 사건
B: 주사위를 굴렸을때 홀수가 나오는 사건
A and B: 여기가 포인트! 숫자 1은 홀수이므로, 두 조건을 만족하는 경우는 주사위를 굴렸을 때 1이 나오는 사건 뿐 입니다.


따라서 P(A and B)는 1/6이 될 것이고, P(B)는 3/6이 됩니다. 위의 식에 숫자를 짚어넣어보면, 조건부 확률값을 구할 수 있습니다.


P(주사위의 숫자가 홀수 나왔다는 전체하에 1이 나오는 사건) = P(A | B) = (1/6) / (3/6)  = 1/3


### Bayes' rule (베이즈 정리)

베이즈 정리란 두 사건 A와 B가 주어졌을때, 조건부 확률과 각각의 확률 정보를 사용하여 순서가 뒤바뀐 조건부 확률을 쉽게 구할 수 있는 정리입니다. 말로 하면 애매하니 수식을 사용해서 표현해보면 아래와 같습니다.


![image from D:\user\Documents\R projects\Tistory_슬통\Tistory](img2.jpg){width=50%}

즉, 오른쪽에 있는 각각의 확률 P(A)와 P(B), 그리고 둘 사이의 조건부 확률 P(B|A)를 이용하면, A와 B의 위치가 뒤바뀐 P(A|B)도 베이즈 정리를 이용해, 쉽게 구할 수 있는거죠!


이 내용에 대해 질병에 대한 양성과 음성의 진단 결과를 민감도(Sensitivity), 특이도(Specificity), 우도비(Likehood ratio) 등의 조건을 통해서 설명하는 예제를 많이 보았습니다. 저 또한 이 예제를 보았는데 너무 이해하기 어려웠고, 그래서 이해하기 쉽게 설명하시는 위니버스라는 유투버의 영상을 가져왔습니다. 베이즈 정리를 '발렌타인데이에 초콜릿을 준 사람이 날 좋아할 확률'이라는 주제로 풀어놓은 영상입니다.

(https://youtu.be/Y4ecU7NkiEI)



### 예제로 알아보기 - 초콜릿을 준 코니의 마음

펭수는 평소 관심이 있던 코니에게서 초콜릿을 선물받습니다. 펭수는 초콜릿을 준 코니가 나를 좋아하는지가 궁금하기 때문에 이것을 통계적으로 해봅니다. 먼저 상황을 간단히 나타내기 위해서 다음 두 상황을 가정합니다.

**P(A)**(사건 "호감"): 상대방이 나를 좋아한다. 
**P(B)**(사건 "초콜릿"): 초콜릿을 받았다.


펭수는 사건 "호감"에 대한 확률, 즉, 코니가 나를 좋아할 확률을 50%, 좋아하지 않을 확률을 50%로 가정합니다. 즉, P(A)=0.5 로 표현이 될 것입니다. 이러한 이유는 펭수는 초콜릿을 준 코니 마음에 대한 아무런 정보가 없기 때문입니다! 


**The Principle of Insufficient Reason(이유불충분의 원리)**: 하나의 사건을 기대할만한 어떤 이유가 없는 경우에는 가능한 모든 사건에 동일한 확률을 할당해야 한다는 원칙.


쉽게 이해하기 위하여, 주변에 100명의 사람이 있다고 가정합니다. 이유불충분의 원리에 따라 50명은 누군가로부터 호감을 받고 있고, 50명은 호감을 얻고 있지 않고 있겠네요!

그리고 펭수는 조사를 통해 두 가지 정보를 알게됩니다.

* 어떤 사람이 상대방에게 호감이 있어서 초콜릿을 줄 확률은 40%이다. -> **P(B|A)=0.4**
* 어떤 사람이 상대방에게 호감이 없지만 "예의상" 초콜릿을 줄 확률은 30%이다. (어장 관리 그만ㅠ) -> **P(B|Ac)=0.3**


이 정보를 토대로 우리는 아래 두가지를 유추할 수 있습니다.

* 상대방에게 호감이 있지만 초콜릿을 주지 않을 확률은 60%이다. -> **P(Bc|A)=0.6**
* 호감이 없어서 초콜릿을 주지 않을 확률은 70%이다. -> **P(Bc|Ac)=0.7**


#### 얻은 정보 정리해보기

이 내용들을 토대로 생각해볼 때, 위 내용들은 아래와 같이 정리할 수 있습니다. 

- 호감을 얻고 있는 50명 중 40%인 20명은 초콜릿을 받을 것입니다.
- 호감을 얻고 있는 50명 중 60%인 30명은 초콜릿을 받지 못합니다.
- 호감의 대상이 아닌 50명 중 30%인 15명은 예의상 준 초콜릿을 받습니다.
- 호감의 대상이 아닌 50명 중 70%인 35명은 초콜릿을 받지 못합니다.

자, 이제 펭수가 궁금한 P(초콜릿을 받았을 때, 초콜릿을 준 사람이 나를 좋아할 확률)을 위에서 약속한 기호로 표현한다면 P(A|B) 으로 나타낼 수 있습니다. 그런데 이것은 펭수가 조사한 확률,

**P(호감이있어서초콜릿을줄확률) = P(B|A)**


에서 조건과 결과가 뒤바뀐 것입니다. 이 확률을 계산하기 위해서 필요한 정보를 정리해봅시다.


사건 "호감" : 상대방이 나를 좋아한다 -> **P(A) = 50%** 이고 (이유불충분의 원리, 사전가정!),
사건 "초콜릿" : 초콜릿을 받았다 -> **P(B) = (20+15)/100 = 35%** (정리한 노란색 부분)입니다.
어떤 사람이 상대방에게 호감이 있어서 초콜릿을 줄 확률은 40%이다. -> **P(B|A)=40%** (펭수가 조사한 정보)

 

이것을 베이즈정리의 수식에 넣어보면 다음과 같습니다.

**P(A|B)=P(B|A)∗P(A)/P(B)=(0.4∗0.5)/0.35=0.57**


이라는 확률이 나옵니다. 따라서, 펭수는 처음의 이유불충분의 원리로 가정했던, 상대방이 나를 좋아할 확률 **50%(사전확률) P(A)**를 **57%(사후확률) P(A|B)**로 업데이트 할 수 있습니다.


이번 글의 가장 중요한 요지는, 베이즈 정리라는 것은 새로운 정보를 통해 사전 확률을 업데이트 하여 사후 확률에 대한 정확도를 높여가는 것이라는 점입니다. 그리고 이러한 개념들이 어떻게 데이터 분석에 활용될 수 있는지 한 번 생각해보고자 합니다. 


혹시 내용에 오류가 있다면 언제든지 댓글/피드백 달아주세요 🎆 잘못된 내용 알려주시는 것 언제나 환영입니다 👩‍🚀





### 몬티홀 딜레마 : 베이즈 정리와 연관된 유명한 확률 역설

베이즈 정리의 연장선에서 또 하나 말할 것이 있다면 몬티홀 딜레마를 말할 수 있습니다. 몬티홀은 Let's make a deal이라는 미국 게임쇼 프로그램의 사회자였습니다. 이 프로그램은 참가자에게 세 개의 문을 제공하고, 그 중 한개의 문에 자동차를 숨겨놓다가 참가자가 자동차가 숨겨진 문을 고르면 경품을 증정하는 게임쇼였습니다. 만약 참가자가 1번 문을 선택하면, 프로그램 진행자인 몬티홀은 남은 두 문 중 한개를 오픈하여 문 뒤에 염소가 있다는 것을 보여줍니다. 그리고 진행자는 참가자에게 남은 한개의 문으로 선택을 바꾸겠냐고 묻습니다. 이 때, 선택을 바꾸는 것과 바꾸지 않는 것 중 어느 쪽이 차가 있는 문을 고를 확률이 높은지에 대해 당시 많은 통계학자들이 논쟁을 벌였다고 합니다.

이 상황을 베이즈 정리의 개념을 토대로 생각해보겠습니다. 먼저 출연자가 C라는 문에 자동차가 있을 것이라고 골랐을 때, 확률은 아래와 같다고 생각할 수 있습니다.

- 자동차가 A 문에 있을 확률 P(차A): 1/3
- 자동차가 B 문에 있을 확률 P(차B): 1/3
- 자동차가 C 문에 있을 확률 P(차C): 1/3

여기서 사회자는 가정을 합니다.

가정(1) A에 자동차가 있을 경우, 사회자는 B문을 열어 염소를 보여주어야 한다.
가정(2) B에 자동차가 있을 경우, 사회자는 A문을 열어 염소를 보여주어야 한다. 

가정(1)의 상황에서 A에 자동차가 있다면 사회자는 문 B를 열어야 하기 때문에 이 확률은 1/3입니다. 그리고 자동차가 출연자가 고른 문C에 있다면, 사회자가 A,B 중 B를 열 확률은 1/3의 확률의 1/2이 됩니다(이유 불충분의 원리에 따라). 따라서 가정(1)에서 **사회자가 문B를 오픈할 확률은 1/6+1/3 = 1/2**이 됩니다.

마찬가지로, 가정(2)의 상황에서 B에 자동차가 있다면 사회자는 문 A를 열 수밖에 없을 것이고, 이 확률은 1/3입니다. 그리고 자동차가 문C에 있다면, 사회자가 A를 열 확률은 1/3중 1/2이 되기 때문에 **문 A가 오픈될 확률은 총 1/2**이 됩니다.

**만일 사회자가 사회자가 문 A를 열어 염소를 보여주었다고 합시다(가정(2)의 상황).** 참가자는 2번 문에 염소가 있다는 것을 알게됩니다. 그렇다면, B를 오픈하는 상황은 일어나지 않았기 때문에 가능성이 사라지게 되고, A를 오픈했을 때 **B에 자동차가 있을 확률은 2/3가 된다**는 것을 알 수 있습니다.

그러나 이 문제가 간단하지 않은 것은 여기서 또 다른 사회자의 전략을 고려할 수 있기 때문입니다. 만일 참가자가 처음 고른 문 C에 자동차가 있었을 경우, 애초부터 두 개의 문 중 B를 오픈하겠다고 전략을 세우고 있었을 수도 있습니다. 그럴 경우에는 **A와 C에 자동차가 있을 확률이 50%**가 됩니다.

**참가자가 처음 문C를 골랐을 때, 차가 있을 확률은 1/3**이었습니다. 그러나 만약 사회자가 위에서 설명한 가정(1), (2)를 고려하는 전략을 취했다면, **참가자가 다른 문으로 선택을 바꾸었을 때 그 문에 차가 있을 확률이 2/3**로 높아집니다. 그러나 또한, 마지막으로 말했던 것처럼 사회자가 참가자가 고른 문에 자동차가 있었기 때문에 A, B중 어느 한 개의 문을 열기로 애초부터 정해놓은 전략을 취했을 수도 있습니다. 이 경우 **참가자가 다른 문을 고른다면, 그 문에 차가 있을 확률이 1/2**이 됩니다.

결국에는 진행자가 어떤 전략을 세웠었는지에 따라 확률은 조금씩 달라지기 때문에 문을 바꾸는 것이 확실히 맞는 결정이다라고 말할 수는 없다고 합니다. 제가 이 몬티홀 딜레마를 소개하는 것은 어느 선택이 맞다라는 것을 논쟁하려는 것은 아니고, 이런 재미있는 에피소드를 통해서 베이즈 정리라는 것의 개념을 한 번 다시 생각해보고 싶어서입니다.










